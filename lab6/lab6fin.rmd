---
title: "lab6"
author: "Андрей Мухтаров"
date: '20 декабря 2016 г '
output: html_document
---



## R Markdown
Прочитайте файл в переменную
```{r}
data<-read.csv('https://raw.githubusercontent.com/SergeyMirvoda/da2016/master/lab6/wtid-report.csv')
```

На основе полученных данных создайте новую переменную в которой будут следующие колонки (наблюдения): 'Year', 'P99', 'P99.5' и 'P99.9';
```{r}
data2<-data.frame(Year=data$Year,P99=data$P99.income.threshold,P99.5=data$P99.5.income.threshold,P99.9=data$P99.9.income.threshold)
```
Чему равнялся P99 в 1972? P99.5 в 1942? P99.9 в 1922?
```{r}
data2$P99[data2$Year==1972]
data2$P99.5[data2$Year==1942]
data2$P99.9[data2$Year==1922]
```
Постройте диаграмму рассеяний всех трёх персентилей относительно времени. Проверьте, чтобы метки осей были корректными и на оси x были годы от 1913 до 2012.
```{r}
plot(data2$Year,data2$P99,xlab = 'Года', ylab = 'Доход',main='для P99')
plot(data2$Year,data2$P99.5,xlab = 'Года', ylab = 'Доход',main='для P99.5')
plot(data2$Year,data2$P99.9,xlab = 'Года', ylab = 'Доход',main='для P99.9')
```
Из предыдущих вычислений можно получить, что оценить параметр a можно по следующей формуле: a = 1 - log(10)/log(P99/P99.9) (3). Напишите функцию my.exp.estimate_ratio, которая принимает аргументы P99 и P99.9 и возвращает a, рассчитанное по формуле (3). Проверьте, что при P99 = 1e6 и P99.9 = 1e7 функция вернёт a = 2. ### 
```{r}
my.exp.estimate_ratio =function(x,y){
  a<-1-log(10)/log(x/y)
  return(a)
}

my.exp.estimate_ratio(10^6,10^7)
```
Задание 2
Получите значение a для каждого года в наборе данных. 
```{r}
a_year<-data.frame(year=data2$Year,a= my.exp.estimate_ratio(data2$P99,data2$P99.9))
```
Постройте график а относительно годов. Что можно сказать по полученному графику, соотносится ли это с тем, что имеется на самом деле? (Имейте ввиду, чем экспонента меньше, тем выше неравенство)
```{r}
plot(a_year,xlab='Год',ylab='a', main="a по годам")

q<-data.frame(year=data2$Year, a=data2$P99.9-data2$P99) ##разница доходов 2х персентилей
plot(q, xlab='Год',ylab='Доход vs а', main="разница доходов по годам vs (а) по годам", type='l')
par(new=TRUE)
plot(a_year, xlab='Год',ylab='Доход vs а', col="red", type="l")
##из графика видно что чем экспонента меньше, тем выше неравенство, следовательно все соответствует реальности
```
Используя полученную для 2012 года оценку параметра a проверьте выполняется ли принцип Парето (20% популяции владеет 80 % богатства) однако зависит от конкретной величины k).
```{r}
a<-a_year$a[a_year$year=="2012"]

doohod_max<-max(data2[data2$Year=="2012",])
pareto<-(doohod_max*0.82/doohod_max)^(-a+1)
##исходя из того что коэфициент а=1 для случая 18% популяции владеет 82% дохода.
## тогда а=1.4 показывает что 82% дохода владеют 25% популяции.
```
Из выражения (3) можно вывести следующее: (P99.5/P99.9)^(-a+1) = 5. Напишите функцию, которая будет принимать P99.5, P99.9 и a , и вычислять левую часть выражения. Отобразите полученное на графике. На нём же отобразите горизонтальную прямую с вертикальной координатой равной 5 (при помощи команды abline). Насколько качественно выполнена подгонка модели?
```{r}
PE=function(P99.5,P99.9, a){
left<-(P99.5/P99.9)^(-a+1)
return(left)
}
Par3<-PE(data2$P99.5,data2$P99.9,a_year$a)
plot(data2$Year, Par3, xlab = "Годы", type = "l", main = "Для P99.5/P99.9)^(-a+1) = 5")
abline(h = 5, col = "red")
## подгонка модели выполнена достаточно качественно. Значения распределены достаточно равномерно
```
Тоже самое верно и для: (P90/P95)^(-a+1) = 2. Повторите предыдущее для этой формулы. Что можно сказать, сравнив эти подгонки?
```{r}
Par4<-PE(data$P90.income.threshold ,data2$P99.5,a_year$a)
plot(data2$Year, Par4, xlab = "Годы", type = "l", asp =1,  main = "Для (P90/P95)^(-a+1) = 2")
abline(h = 2, col = "red")
## эта подгонка не является качественной, что видно из графика
```
